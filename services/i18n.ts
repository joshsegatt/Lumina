
import React, { createContext, useState, useContext, ReactNode } from 'react';
import type { LanguageCode } from '../types';

const translations: Record<LanguageCode, Record<string, string>> = {
  en: {
    // TopBar
    'chat': 'Chat',
    'history': 'History',
    'settings': 'Settings',
    // Error Boundaries
    'errorInChat': 'Chat Error',
    'errorInHistory': 'History Error',
    'errorInSettings': 'Settings Error',
    // History Screen
    'conversationHistory': 'Conversation History',
    'startNewChat': 'Start New Chat',
    'deleteConfirm': 'Are you sure you want to delete this chat?',
    'noConversations': 'No conversations yet.',
    'deleteChat': 'Delete Chat',
    'clearHistory': 'Clear All History',
    'clearHistoryConfirm': 'Are you sure you want to delete all conversations? This action cannot be undone.',
    // Settings Screen
    'appSettings': 'App Settings',
    'language': 'Language',
    'theme': 'Theme',
    'light': 'Light',
    'dark': 'Dark',
    'system': 'System',
    'modelManagement': 'Model Management',
    'activeModel': 'Active Model',
    'clearCache': 'Clear Model Cache',
    'clearCacheConfirm': 'This will delete the downloaded model from your device. You will need to re-download it. Are you sure?',
    'cacheCleared': 'Model cache cleared successfully.',
    'privacyData': 'Privacy & Data',
    'analytics': 'Anonymous Analytics',
    'analyticsDesc': 'Help us improve Lumina by sharing anonymous usage data.',
    'about': 'About Lumina',
    'version': 'Version 1.0.0',
    'changeModel': 'Change Model',
    // Model Loader
    'modelSelection': 'Model Selection',
    'chooseOfflineModel': 'Choose an Offline Model',
    'modelDescription': 'Select a model to download and run directly in your browser. Your data remains private and secure on your device.',
    'loadModel': 'Download & Load',
    'loadingModel': 'Preparing {modelName}...',
    'engineFail': 'Engine Failed to Start',
    'tryAgain': 'Try Again',
    'cancel': 'Cancel',
    'loadFromDevice': 'Load from Device',
    'loadFromDeviceDescription': 'Load any GGUF model from your computer.',
    'chooseFile': 'Choose File',
    // Home/Feature Screen
    'homeTagline': '',
  },
  pt: {
    'chat': 'Chat',
    'history': 'Histórico',
    'settings': 'Configurações',
    'errorInChat': 'Erro no Chat',
    'errorInHistory': 'Erro no Histórico',
    'errorInSettings': 'Erro nas Configurações',
    'conversationHistory': 'Histórico de Conversas',
    'startNewChat': 'Iniciar Novo Chat',
    'deleteConfirm': 'Tem certeza que deseja apagar este chat?',
    'noConversations': 'Nenhuma conversa ainda.',
    'deleteChat': 'Apagar Chat',
    'clearHistory': 'Limpar todo o histórico',
    'clearHistoryConfirm': 'Tem certeza de que deseja excluir todas as conversas? Esta ação não pode ser desfeita.',
    'appSettings': 'Configurações do App',
    'language': 'Idioma',
    'theme': 'Tema',
    'light': 'Claro',
    'dark': 'Escuro',
    'system': 'Sistema',
    'modelManagement': 'Gerenciamento de Modelo',
    'activeModel': 'Modelo Ativo',
    'clearCache': 'Limpar Cache do Modelo',
    'clearCacheConfirm': 'Isso excluirá o modelo baixado do seu dispositivo. Você precisará baixá-lo novamente. Tem certeza?',
    'cacheCleared': 'Cache do modelo limpo com sucesso.',
    'privacyData': 'Privacidade e Dados',
    'analytics': 'Análise Anônima',
    'analyticsDesc': 'Ajude-nos a melhorar o Lumina compartilhando dados de uso anônimos.',
    'about': 'Sobre o Lumina',
    'version': 'Versão 1.0.0',
    'changeModel': 'Mudar Modelo',
    'modelSelection': 'Seleção de Modelo',
    'chooseOfflineModel': 'Escolha um Modelo Offline',
    'modelDescription': 'Selecione um modelo para baixar e executar diretamente no seu navegador. Seus dados permanecem privados e seguros no seu dispositivo.',
    'loadModel': 'Baixar e Carregar',
    'loadingModel': 'Preparando {modelName}...',
    'engineFail': 'Falha ao Iniciar o Motor',
    'tryAgain': 'Tentar Novamente',
    'cancel': 'Cancelar',
    'loadFromDevice': 'Carregar do Dispositivo',
    'loadFromDeviceDescription': 'Carregue qualquer modelo GGUF do seu computador.',
    'chooseFile': 'Escolher Arquivo',
    'homeTagline': '',
  },
  es: {
    'chat': 'Chat',
    'history': 'Historial',
    'settings': 'Configuración',
    'errorInChat': 'Error en el Chat',
    'errorInHistory': 'Error en el Historial',
    'errorInSettings': 'Error en la Configuración',
    'conversationHistory': 'Historial de Conversaciones',
    'startNewChat': 'Iniciar Nuevo Chat',
    'deleteConfirm': '¿Estás seguro de que quieres eliminar este chat?',
    'noConversations': 'Aún no hay conversaciones.',
    'deleteChat': 'Eliminar Chat',
    'clearHistory': 'Borrar todo el historial',
    'clearHistoryConfirm': '¿Estás seguro de que quieres eliminar todas las conversaciones? Esta acción no se puede deshacer.',
    'appSettings': 'Ajustes de la App',
    'language': 'Idioma',
    'theme': 'Tema',
    'light': 'Claro',
    'dark': 'Oscuro',
    'system': 'Sistema',
    'modelManagement': 'Gestión de Modelos',
    'activeModel': 'Modelo Activo',
    'clearCache': 'Limpiar Caché del Modelo',
    'clearCacheConfirm': 'Esto eliminará el modelo descargado de tu dispositivo. Tendrás que volver a descargarlo. ¿Estás seguro?',
    'cacheCleared': 'Caché del modelo borrada con éxito.',
    'privacyData': 'Privacidad y Datos',
    'analytics': 'Análisis Anónimos',
    'analyticsDesc': 'Ayúdanos a mejorar Lumina compartiendo datos de uso anónimos.',
    'about': 'Acerca de Lumina',
    'version': 'Versión 1.0.0',
    'changeModel': 'Cambiar Modelo',
    'modelSelection': 'Selección de Modelo',
    'chooseOfflineModel': 'Elige un Modelo sin Conexión',
    'modelDescription': 'Selecciona un modelo para descargar y ejecutar directamente en tu navegador. Tus datos permanecen privados y seguros en tu dispositivo.',
    'loadModel': 'Descargar y Cargar',
    'loadingModel': 'Preparando {modelName}...',
    'engineFail': 'Error al Iniciar el Motor',
    'tryAgain': 'Intentar de Nuevo',
    'cancel': 'Cancelar',
    'loadFromDevice': 'Cargar desde Dispositivo',
    'loadFromDeviceDescription': 'Carga cualquier modelo GGUF desde tu ordenador.',
    'chooseFile': 'Elegir Archivo',
    'homeTagline': '',
  },
  fr: {
    'chat': 'Chat',
    'history': 'Historique',
    'settings': 'Paramètres',
    'errorInChat': 'Erreur dans le Chat',
    'errorInHistory': 'Erreur dans l\'Historique',
    'errorInSettings': 'Erreur dans les Paramètres',
    'conversationHistory': 'Historique des Conversations',
    'startNewChat': 'Démarrer un Nouveau Chat',
    'deleteConfirm': 'Êtes-vous sûr de vouloir supprimer ce chat ?',
    'noConversations': 'Aucune conversation pour le moment.',
    'deleteChat': 'Supprimer le Chat',
    'clearHistory': 'Effacer tout l\'historique',
    'clearHistoryConfirm': 'Êtes-vous sûr de vouloir supprimer toutes les conversations ? Cette action est irréversible.',
    'appSettings': "Paramètres de l'App",
    'language': 'Langue',
    'theme': 'Thème',
    'light': 'Clair',
    'dark': 'Sombre',
    'system': 'Système',
    'modelManagement': 'Gestion du Modèle',
    'activeModel': 'Modèle Actif',
    'clearCache': 'Vider le Cache du Modèle',
    'clearCacheConfirm': 'Cela supprimera le modèle téléchargé de votre appareil. Vous devrez le retélécharger. Êtes-vous sûr ?',
    'cacheCleared': 'Cache du modèle vidé avec succès.',
    'privacyData': 'Confidentialité et Données',
    'analytics': 'Analyses Anonymes',
    'analyticsDesc': 'Aidez-nous à améliorer Lumina en partageant des données d\'utilisation anonymes.',
    'about': 'À propos de Lumina',
    'version': 'Version 1.0.0',
    'changeModel': 'Changer de Modèle',
    'modelSelection': 'Sélection du Modèle',
    'chooseOfflineModel': 'Choisissez un Modèle Hors Ligne',
    'modelDescription': 'Sélectionnez un modèle à télécharger et à exécuter directly dans votre navigateur. Vos données restent privées et sécurisées sur votre appareil.',
    'loadModel': 'Télécharger et Charger',
    'loadingModel': 'Préparation de {modelName}...',
    'engineFail': 'Échec du Démarrage du Moteur',
    'tryAgain': 'Réessayer',
    'cancel': 'Annuler',
    'loadFromDevice': 'Charger depuis l\'Appareil',
    'loadFromDeviceDescription': 'Chargez n\'importe quel modèle GGUF depuis votre ordinateur.',
    'chooseFile': 'Choisir un Fichier',
    'homeTagline': '',
  },
  de: {
    'chat': 'Chat',
    'history': 'Verlauf',
    'settings': 'Einstellungen',
    'errorInChat': 'Fehler im Chat',
    'errorInHistory': 'Fehler im Verlauf',
    'errorInSettings': 'Fehler in den Einstellungen',
    'conversationHistory': 'Gesprächsverlauf',
    'startNewChat': 'Neuen Chat starten',
    'deleteConfirm': 'Möchten Sie diesen Chat wirklich löschen?',
    'noConversations': 'Noch keine Gespräche.',
    'deleteChat': 'Chat löschen',
    'clearHistory': 'Gesamten Verlauf löschen',
    'clearHistoryConfirm': 'Möchten Sie wirklich alle Gespräche löschen? Diese Aktion kann nicht rückgängig gemacht werden.',
    'appSettings': 'App-Einstellungen',
    'language': 'Sprache',
    'theme': 'Thema',
    'light': 'Hell',
    'dark': 'Dunkel',
    'system': 'System',
    'modelManagement': 'Modellverwaltung',
    'activeModel': 'Aktives Modell',
    'clearCache': 'Modell-Cache leeren',
    'clearCacheConfirm': 'Dadurch wird das heruntergeladene Modell von Ihrem Gerät gelöscht. Sie müssen es erneut herunterladen. Sind Sie sicher?',
    'cacheCleared': 'Modell-Cache erfolgreich geleert.',
    'privacyData': 'Datenschutz & Daten',
    'analytics': 'Anonyme Analysen',
    'analyticsDesc': 'Helfen Sie uns, Lumina zu verbessern, indem Sie anonyme Nutzungsdaten teilen.',
    'about': 'Über Lumina',
    'version': 'Version 1.0.0',
    'changeModel': 'Modell ändern',
    'modelSelection': 'Modellauswahl',
    'chooseOfflineModel': 'Wählen Sie ein Offline-Modell',
    'modelDescription': 'Wählen Sie ein Modell zum Herunterladen aus, das direkt in Ihrem Browser ausgeführt wird. Ihre Daten bleiben privat und sicher auf Ihrem Gerät.',
    'loadModel': 'Herunterladen & Laden',
    'loadingModel': 'Bereite {modelName} vor...',
    'engineFail': 'Engine konnte nicht gestartet werden',
    'tryAgain': 'Erneut versuchen',
    'cancel': 'Abbrechen',
    'loadFromDevice': 'Von Gerät laden',
    'loadFromDeviceDescription': 'Laden Sie ein beliebiges GGUF-Modell von Ihrem Computer.',
    'chooseFile': 'Datei auswählen',
    'homeTagline': '',
  },
  ja: {
    'chat': 'チャット',
    'history': '履歴',
    'settings': '設定',
    'errorInChat': 'チャットエラー',
    'errorInHistory': '履歴エラー',
    'errorInSettings': '設定エラー',
    'conversationHistory': '会話履歴',
    'startNewChat': '新しいチャットを開始',
    'deleteConfirm': 'このチャットを本当に削除しますか？',
    'noConversations': 'まだ会話はありません。',
    'deleteChat': 'チャットを削除',
    'clearHistory': '全履歴を消去',
    'clearHistoryConfirm': '本当にすべての会話を削除しますか？この操作は元に戻せません。',
    'appSettings': 'アプリ設定',
    'language': '言語',
    'theme': 'テーマ',
    'light': 'ライト',
    'dark': 'ダーク',
    'system': 'システム',
    'modelManagement': 'モデル管理',
    'activeModel': 'アクティブなモデル',
    'clearCache': 'モデルキャッシュをクリア',
    'clearCacheConfirm': 'ダウンロードしたモデルがデバイスから削除されます。再度ダウンロードする必要があります。よろしいですか？',
    'cacheCleared': 'モデルキャッシュが正常にクリアされました。',
    'privacyData': 'プライバシーとデータ',
    'analytics': '匿名分析',
    'analyticsDesc': '匿名の利用状況データを共有して、Luminaの改善にご協力ください。',
    'about': 'Luminaについて',
    'version': 'バージョン 1.0.0',
    'changeModel': 'モデルを変更',
    'modelSelection': 'モデル選択',
    'chooseOfflineModel': 'オフラインモデルを選択',
    'modelDescription': 'モデルを選択して、ブラウザで直接ダウンロードして実行します。データはデバイス上でプライベートかつ安全に保たれます。',
    'loadModel': 'ダウンロードして読み込む',
    'loadingModel': '{modelName}を準備中...',
    'engineFail': 'エンジンの起動に失敗しました',
    'tryAgain': '再試行',
    'cancel': 'キャンセル',
    'loadFromDevice': 'デバイスから読み込む',
    'loadFromDeviceDescription': 'お使いのコンピュータから任意のGGUFモデルを読み込みます。',
    'chooseFile': 'ファイルを選択',
    'homeTagline': '',
  },
  zh: {
    'chat': '聊天',
    'history': '历史',
    'settings': '设置',
    'errorInChat': '聊天错误',
    'errorInHistory': '历史错误',
    'errorInSettings': '设置错误',
    'conversationHistory': '对话历史',
    'startNewChat': '开始新聊天',
    'deleteConfirm': '确定要删除此聊天吗？',
    'noConversations': '还没有对话。',
    'deleteChat': '删除聊天',
    'clearHistory': '清除所有历史',
    'clearHistoryConfirm': '确定要删除所有对话吗？此操作无法撤销。',
    'appSettings': '应用设置',
    'language': '语言',
    'theme': '主题',
    'light': '浅色',
    'dark': '深色',
    'system': '系统',
    'modelManagement': '模型管理',
    'activeModel': '当前模型',
    'clearCache': '清除模型缓存',
    'clearCacheConfirm': '这将从您的设备中删除已下载的模型。您需要重新下载。确定吗？',
    'cacheCleared': '模型缓存已清除。',
    'privacyData': '隐私和数据',
    'analytics': '匿名分析',
    'analyticsDesc': '通过分享匿名使用数据帮助我们改进 Lumina。',
    'about': '关于 Lumina',
    'version': '版本 1.0.0',
    'changeModel': '更换模型',
    'modelSelection': '模型选择',
    'chooseOfflineModel': '选择离线模型',
    'modelDescription': '选择一个模型下载并直接在浏览器中运行。您的数据保持私密和安全。',
    'loadModel': '下载并加载',
    'loadingModel': '正在准备 {modelName}...',
    'engineFail': '引擎启动失败',
    'tryAgain': '重试',
    'send': '发送',
    'typeMessage': '输入消息...',
    'stopGenerating': '停止生成',
    'newChat': '新对话',
    'back': '返回',
    'loadFromDevice': '从设备加载',
    'loadFromDeviceDescription': '从您的计算机加载任何 GGUF 模型。',
    'chooseFile': '选择文件',
    'homeTagline': '',
  },
};

interface I18nContextType {
  language: LanguageCode;
  setLanguage: (lang: LanguageCode) => void;
  t: (key: string, replacements?: Record<string, string>) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export const I18nProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<LanguageCode>('en');

  const t = (key: string, replacements?: Record<string, string>) => {
    let translation = translations[language]?.[key] || translations['en'][key] || key;
    if (replacements) {
        Object.keys(replacements).forEach(rKey => {
            translation = translation.replace(`{${rKey}}`, replacements[rKey]);
        });
    }
    return translation;
  };

  return React.createElement(I18nContext.Provider, { value: { language, setLanguage, t } }, children);
};

export const useI18n = () => {
  const context = useContext(I18nContext);
  if (context === undefined) {
    throw new Error('useI18n must be used within an I18nProvider');
  }
  return context;
};